<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Armstrong Pull-up Tracker</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1a3c5e">
  <link rel="icon" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    :root{
      --blue:#1a3c5e;
      --blue2:#2c5282;
      --blue3:#3182ce;
      --bg:#f9f9f9;
      --card:#ffffff;
      --border:#d0d0d0;
      --note:#fffaf0;
      --noteBorder:#d69e2e;
      --total:#fefcbf;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      background: var(--bg);
      color:#111;
      padding: 14px 12px 78px; /* bottom padding for nav */
    }

    .container{ max-width: 720px; margin: 0 auto; }

    header{
      text-align:center;
      padding: 10px 8px 6px;
    }
    h1{ margin: 6px 0 4px; color: var(--blue); font-size: 1.35rem; }
    .sub{ margin:0 0 10px; color:#444; font-size:0.95rem; }

    .card{
      background: var(--card);
      border: 1px solid #e6e6e6;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.07);
      padding: 14px 12px;
      margin: 12px 0;
    }

    .instructions{
      background: var(--note);
      border-left: 5px solid var(--noteBorder);
      border-radius: 12px;
      padding: 12px 12px;
      line-height: 1.35;
      font-size: 0.95rem;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .row > *{ flex: 1 1 140px; }

    label{
      display:block;
      font-weight: 800;
      color:#223;
      margin: 10px 0 6px;
      text-align:left;
    }

    .hint{ font-size:0.85rem; color:#555; margin-top:6px; }

    input[type="number"], select{
      width: 100%;
      padding: 12px 10px;
      border: 1px solid #b6b6b6;
      border-radius: 12px;
      font-size: 1.05rem;
      background:#fff;
      text-align:center;
    }

    textarea{
      width:100%;
      min-height: 170px;
      resize: vertical;
      padding: 12px 10px;
      border: 1px solid #b6b6b6;
      border-radius: 12px;
      font-size: 1.05rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      line-height:1.35;
      background:#fff;
    }

    .pill{
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #e1e1e1;
      background: #fff;
      font-weight: 900;
    }

    .total{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap:10px;
      background: var(--total);
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 900;
      margin-top: 12px;
    }
    .total span{ font-size: 1.1rem; }

    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      margin: 12px 0 0;
    }
    button{
      border: 1px solid #bdbdbd;
      background: #fff;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 800;
      cursor:pointer;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
      flex: 1 1 140px;
    }
    button:active{ transform: translateY(1px); }

    .status{
      text-align:center;
      color:#444;
      font-size: 0.9rem;
      margin-top: 10px;
    }

    /* "One page per day" sections */
    .page{ display:none; }
    .page.active{ display:block; }

    /* Bottom nav */
    .bottom-nav{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(249,249,249,0.92);
      backdrop-filter: blur(8px);
      border-top: 1px solid #e4e4e4;
      padding: 8px 10px 10px;
    }
    .tabs{
      display:flex;
      gap:6px;
      max-width: 760px;
      margin: 0 auto;
    }
    .tab{
      flex:1 1 0;
      border: 1px solid #d7d7d7;
      background: #fff;
      border-radius: 12px;
      padding: 10px 6px;
      font-weight: 900;
      cursor:pointer;
      font-size: 0.92rem;
    }
    .tab.active{
      border-color: var(--blue);
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
    }

    @media (max-width: 420px){
      h1{ font-size: 1.22rem; }
      .tab{ font-size: 0.86rem; padding: 10px 4px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Armstrong Pull-up Tracker</h1>
      <p class="sub">One page per day • Autosave • Offline</p>
    </header>

    <div class="card instructions">
      <strong>Notes:</strong> Day 1/3/4 totals are auto-calculated. Day 2 counts tally marks in the box. Day 5 lets you pick which day (1–4) you’re repeating and tracks it separately.
    </div>

    <div class="card toolbar">
      <button id="btnReset" type="button">Reset All</button>
      <button id="btnExport" type="button">Export</button>
      <button id="btnImport" type="button">Import</button>
    </div>
    <div class="status" id="saveStatus">Saved ✓</div>

    <!-- PAGE: Day 1 -->
    <section class="page active" id="page-day1" aria-label="Day 1">
      <div class="card">
        <h2 style="margin:4px 0 6px; color:var(--blue);">Day 1 — Max Effort</h2>
        <div class="hint">3 max pushup sets, then 5 max effort pull-up sets. Rest 90 seconds.</div>

        <label>Set 1</label><input type="number" min="0" id="d1s1">
        <label>Set 2</label><input type="number" min="0" id="d1s2">
        <label>Set 3</label><input type="number" min="0" id="d1s3">
        <label>Set 4</label><input type="number" min="0" id="d1s4">
        <label>Set 5</label><input type="number" min="0" id="d1s5">

        <div class="total"><div>Total</div><span id="totalD1">0</span></div>
      </div>
    </section>

    <!-- PAGE: Day 2 -->
    <section class="page" id="page-day2" aria-label="Day 2">
      <div class="card">
        <h2 style="margin:4px 0 6px; color:var(--blue);">Day 2 — Pyramid</h2>
        <div class="hint">Pyramid 1,2,3… until missed set. Then one max set.</div>

        <label>Tally box (type <strong>|</strong> or <strong>I</strong>; new line = new set)</label>
        <textarea id="d2tally" placeholder="Example:
|||||
||||
|||"></textarea>

        <div class="row" style="margin-top:10px;">
          <div>
            <label>Count</label>
            <div class="pill"> <span id="tallyCount">0</span> </div>
          </div>
          <div>
            <label>Total (auto, or override)</label>
            <input type="number" min="0" id="totalD2" placeholder="auto (or override)">
            <div class="hint">If you type in Total, it becomes manual until you edit the tally box again.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- PAGE: Day 3 -->
    <section class="page" id="page-day3" aria-label="Day 3">
      <div class="card">
        <h2 style="margin:4px 0 6px; color:var(--blue);">Day 3 — Grip Switch</h2>
        <div class="hint">3 sets overhand, 3 sets palms inward/hands together, 3 sets wide. Rest 60 seconds.</div>

        <label>Set 1</label><input type="number" min="0" id="d3s1">
        <label>Set 2</label><input type="number" min="0" id="d3s2">
        <label>Set 3</label><input type="number" min="0" id="d3s3">
        <label>Set 4</label><input type="number" min="0" id="d3s4">
        <label>Set 5</label><input type="number" min="0" id="d3s5">
        <label>Set 6</label><input type="number" min="0" id="d3s6">
        <label>Set 7</label><input type="number" min="0" id="d3s7">
        <label>Set 8</label><input type="number" min="0" id="d3s8">
        <label>Set 9</label><input type="number" min="0" id="d3s9">

        <div class="total"><div>Total</div><span id="totalD3">0</span></div>
      </div>
    </section>

    <!-- PAGE: Day 4 -->
    <section class="page" id="page-day4" aria-label="Day 4">
      <div class="card">
        <h2 style="margin:4px 0 6px; color:var(--blue);">Day 4 — Max Day</h2>
        <div class="hint">Max number of training sets. Rest 60 seconds.</div>

        <label>Pull-ups per Training Set</label><input type="number" min="0" id="d4train">
        <label>Training Sets Completed</label><input type="number" min="0" id="d4sets">

        <div class="total"><div>Total</div><span id="totalD4">0</span></div>
      </div>
    </section>

    <!-- PAGE: Day 5 -->
    <section class="page" id="page-day5" aria-label="Day 5">
      <div class="card">
        <h2 style="margin:4px 0 6px; color:var(--blue);">Day 5 — Hardest Day</h2>
        <div class="hint">Repeat the hardest workout from Days 1–4 (pick which one below). Tracked separately.</div>

        <label>Which workout are you repeating?</label>
        <select id="d5pick">
          <option value="1">Repeat Day 1 (5 max effort sets)</option>
          <option value="2">Repeat Day 2 (pyramid tally)</option>
          <option value="3">Repeat Day 3 (9 grip-switch sets)</option>
          <option value="4">Repeat Day 4 (training sets)</option>
        </select>

        <!-- Day 5 variants -->
        <div id="d5variant-1" class="d5variant" style="margin-top:12px;">
          <div class="hint"><strong>Day 1 style:</strong> enter 5 sets.</div>
          <label>Set 1</label><input type="number" min="0" id="d5d1s1">
          <label>Set 2</label><input type="number" min="0" id="d5d1s2">
          <label>Set 3</label><input type="number" min="0" id="d5d1s3">
          <label>Set 4</label><input type="number" min="0" id="d5d1s4">
          <label>Set 5</label><input type="number" min="0" id="d5d1s5">
          <div class="total"><div>Total</div><span id="totalD5">0</span></div>
        </div>

        <div id="d5variant-2" class="d5variant" style="margin-top:12px; display:none;">
          <div class="hint"><strong>Day 2 style:</strong> tally box.</div>
          <label>Tally box (type | or I)</label>
          <textarea id="d5d2tally" placeholder="Example:
|||||
||||
|||"></textarea>
          <div class="row" style="margin-top:10px;">
            <div>
              <label>Count</label>
              <div class="pill"><span id="tallyCountD5">0</span></div>
            </div>
            <div>
              <label>Total (auto, or override)</label>
              <input type="number" min="0" id="totalD5d2" placeholder="auto (or override)">
            </div>
          </div>
          <div class="hint">Shown on top: total for Day 5 will use this value.</div>
        </div>

        <div id="d5variant-3" class="d5variant" style="margin-top:12px; display:none;">
          <div class="hint"><strong>Day 3 style:</strong> 9 sets.</div>
          <label>Set 1</label><input type="number" min="0" id="d5d3s1">
<label>Set 2</label><input type="number" min="0" id="d5d3s2">
<label>Set 3</label><input type="number" min="0" id="d5d3s3">
<label>Set 4</label><input type="number" min="0" id="d5d3s4">
<label>Set 5</label><input type="number" min="0" id="d5d3s5">
<label>Set 6</label><input type="number" min="0" id="d5d3s6">
<label>Set 7</label><input type="number" min="0" id="d5d3s7">
<label>Set 8</label><input type="number" min="0" id="d5d3s8">
<label>Set 9</label><input type="number" min="0" id="d5d3s9">
          <div class="total"><div>Total</div><span id="totalD5d3">0</span></div>
        </div>

        <div id="d5variant-4" class="d5variant" style="margin-top:12px; display:none;">
          <div class="hint"><strong>Day 4 style:</strong> training sets.</div>
          <label>Pull-ups per Training Set</label><input type="number" min="0" id="d5d4train">
          <label>Training Sets Completed</label><input type="number" min="0" id="d5d4sets">
          <div class="total"><div>Total</div><span id="totalD5d4">0</span></div>
        </div>

        <div class="card" style="margin-top:14px;">
          <div class="hint"><strong>Day 5 total shown depends on your selection.</strong></div>
          <div class="total"><div>Day 5 Total</div><span id="totalD5Unified">0</span></div>
        </div>

      </div>
    </section>

  </div>

  <!-- Bottom nav -->
  <div class="bottom-nav" role="navigation" aria-label="Day navigation">
    <div class="tabs">
      <button class="tab active" data-target="day1" type="button">Day 1</button>
      <button class="tab" data-target="day2" type="button">Day 2</button>
      <button class="tab" data-target="day3" type="button">Day 3</button>
      <button class="tab" data-target="day4" type="button">Day 4</button>
      <button class="tab" data-target="day5" type="button">Day 5</button>
    </div>
  </div>

<script>
  const STORAGE_KEY = "armstrong_tracker_v3";
  const saveStatus = document.getElementById("saveStatus");

  function setStatus(msg){
    saveStatus.textContent = msg;
    clearTimeout(setStatus._t);
    setStatus._t = setTimeout(() => saveStatus.textContent = "Saved ✓", 900);
  }

  // Navigation
  function showPage(day){
    document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
    document.getElementById(`page-${day}`).classList.add("active");

    document.querySelectorAll(".tab").forEach(t => t.classList.toggle("active", t.dataset.target === day));
    // Save current page in URL hash (nice UX)
    location.hash = day;
    window.scrollTo({top:0, behavior:"instant"});
  }

  document.querySelectorAll(".tab").forEach(btn => {
    btn.addEventListener("click", () => showPage(btn.dataset.target));
  });

  // Calculations
  function sumIds(prefix, count){
    let sum = 0;
    for(let i=1;i<=count;i++){
      const v = parseInt(document.getElementById(`${prefix}${i}`).value) || 0;
      sum += v;
    }
    return sum;
  }

  function calcDay1(){
    const sum = sumIds("d1s", 5);
    document.getElementById("totalD1").textContent = sum;
  }

  function tallyCountFromText(txt){
    const matches = (txt || "").match(/[|I]/g);
    return matches ? matches.length : 0;
  }

  function updateDay2(){
    const count = tallyCountFromText(document.getElementById("d2tally").value);
    document.getElementById("tallyCount").textContent = count;
    const totalInput = document.getElementById("totalD2");
    const source = totalInput.getAttribute("data-source") || "auto";
    if(source === "auto"){
      totalInput.value = count ? String(count) : "";
    }
  }

  function calcDay3(){
    const sum = sumIds("d3s", 9);
    document.getElementById("totalD3").textContent = sum;
  }

  function calcDay4(){
    const perSet = parseInt(document.getElementById("d4train").value) || 0;
    const setsDone = parseInt(document.getElementById("d4sets").value) || 0;
    document.getElementById("totalD4").textContent = perSet * setsDone;
  }

  // Day 5 calculations
  function calcDay5Variant1(){
    document.getElementById("totalD5").textContent = sumIds("d5d1s", 5);
  }
  function calcDay5Variant2(){
    const count = tallyCountFromText(document.getElementById("d5d2tally").value);
    document.getElementById("tallyCountD5").textContent = count;
    const totalInput = document.getElementById("totalD5d2");
    const source = totalInput.getAttribute("data-source") || "auto";
    if(source === "auto"){
      totalInput.value = count ? String(count) : "";
    }
  }
  function calcDay5Variant3(){
    document.getElementById("totalD5d3").textContent = sumIds("d5d3s", 9);
  }
  function calcDay5Variant4(){
    const perSet = parseInt(document.getElementById("d5d4train").value) || 0;
    const setsDone = parseInt(document.getElementById("d5d4sets").value) || 0;
    document.getElementById("totalD5d4").textContent = perSet * setsDone;
  }

  function updateDay5Unified(){
    const pick = document.getElementById("d5pick").value;
    let total = 0;
    if(pick === "1"){
      total = parseInt(document.getElementById("totalD5").textContent) || 0;
    }else if(pick === "2"){
      total = parseInt(document.getElementById("totalD5d2").value) || 0;
    }else if(pick === "3"){
      total = parseInt(document.getElementById("totalD5d3").textContent) || 0;
    }else{
      total = parseInt(document.getElementById("totalD5d4").textContent) || 0;
    }
    document.getElementById("totalD5Unified").textContent = total;
  }

  function setDay5Variant(pick){
    document.querySelectorAll(".d5variant").forEach(v => v.style.display = "none");
    document.getElementById(`d5variant-${pick}`).style.display = "block";
    recalcAll();
  }

  document.getElementById("d5pick").addEventListener("change", (e) => {
    setDay5Variant(e.target.value);
    saveAll();
  });

  function recalcAll(){
    calcDay1();
    updateDay2();
    calcDay3();
    calcDay4();

    calcDay5Variant1();
    calcDay5Variant2();
    calcDay5Variant3();
    calcDay5Variant4();
    updateDay5Unified();
  }

  // Save/Load
  function getAllFields(){
    const fields = Array.from(document.querySelectorAll('input[type="number"], textarea, select'));
    return fields;
  }

  function saveAll(){
    const data = {};
    getAllFields().forEach(el => data[el.id] = el.value ?? "");
    // track auto/manual sources for the two pyramid totals
    const sources = {
      totalD2: document.getElementById("totalD2").getAttribute("data-source") || "auto",
      totalD5d2: document.getElementById("totalD5d2").getAttribute("data-source") || "auto"
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify({ savedAt: new Date().toISOString(), data, sources }));
    setStatus("Saved ✓");
  }

  function loadAll(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
      const parsed = JSON.parse(raw);
      const data = parsed.data || {};
      getAllFields().forEach(el => {
        if(Object.prototype.hasOwnProperty.call(data, el.id)){
          el.value = data[el.id];
        }
      });
      const sources = parsed.sources || {};
      document.getElementById("totalD2").setAttribute("data-source", sources.totalD2 || "auto");
      document.getElementById("totalD5d2").setAttribute("data-source", sources.totalD5d2 || "auto");

      // Ensure correct day5 variant visible
      setDay5Variant(document.getElementById("d5pick").value || "1");

      recalcAll();
      setStatus("Loaded ✓");
    }catch(e){
      console.warn("Load failed", e);
    }
  }

  function resetAll(){
    if(!confirm("Reset all fields? This clears saved data too.")) return;
    getAllFields().forEach(el => {
      if(el.tagName.toLowerCase() === "select"){
        el.value = "1";
      }else{
        el.value = "";
      }
    });
    localStorage.removeItem(STORAGE_KEY);
    document.getElementById("totalD2").setAttribute("data-source","auto");
    document.getElementById("totalD5d2").setAttribute("data-source","auto");
    setDay5Variant("1");
    recalcAll();
    setStatus("Reset ✓");
  }

  function exportData(){
    const raw = localStorage.getItem(STORAGE_KEY) || JSON.stringify({savedAt:null, data:{}, sources:{}});
    const blob = new Blob([raw], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "armstrong-tracker-data.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function importData(){
    const input = document.createElement("input");
    input.type = "file";
    input.accept = "application/json";
    input.onchange = () => {
      const file = input.files && input.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const parsed = JSON.parse(reader.result);
          if(!parsed || typeof parsed !== "object" || !parsed.data) throw new Error("Invalid file");
          localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed));
          loadAll();
          setStatus("Imported ✓");
        }catch(e){
          alert("That file doesn't look like an Armstrong tracker export.");
        }
      };
      reader.readAsText(file);
    };
    input.click();
  }

  document.getElementById("btnReset").addEventListener("click", resetAll);
  document.getElementById("btnExport").addEventListener("click", exportData);
  document.getElementById("btnImport").addEventListener("click", importData);

  // autosave debounce
  let t;
  document.addEventListener("input", (e) => {
    if(!e.target) return;

    // Manual overrides for totals
    if(e.target.id === "totalD2"){
      e.target.setAttribute("data-source","manual");
    }
    if(e.target.id === "d2tally"){
      document.getElementById("totalD2").setAttribute("data-source","auto");
    }
    if(e.target.id === "totalD5d2"){
      e.target.setAttribute("data-source","manual");
    }
    if(e.target.id === "d5d2tally"){
      document.getElementById("totalD5d2").setAttribute("data-source","auto");
    }

    if(e.target.matches('input[type="number"], textarea')){
      recalcAll();
      clearTimeout(t);
      t = setTimeout(saveAll, 120);
    }
  });

  // Load initial page from hash (nice)
  window.addEventListener("load", () => {
    loadAll();
    recalcAll();
    const hash = (location.hash || "").replace("#","");
    if(["day1","day2","day3","day4","day5"].includes(hash)){
      showPage(hash);
    }
  });

  // Service worker for offline
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    });
  }
</script>
</body>
</html>
